# 贪吃蛇游戏系统

完整的Web端贪吃蛇游戏系统，支持扫码登录、游戏记录持久化、管理员后台管理等功能。

## 📋 目录

- [功能特点](#功能特点)

- [使用说明](#使用说明)

- [TOTP注册机](#totp注册机)

- [默认配置](#默认配置)

- [技术栈](#技术栈)

- [部署说明](#部署说明)

- [注意事项](#注意事项)

- [常见问题](#常见问题)

- [更新日志](#更新日志)

  ## 样图

  ![image-20260109080933987](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109080933987.png)

  ![image-20260109080955323](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109080955323.png)

![image-20260109081049053](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109081049053.png)



![image-20260109081117494](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109081117494.png)

![image-20260109081149798](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109081149798.png)

![image-20260109081218202](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260109081218202.png)

## 功能特点

### 1. 游戏基础功能
- 经典贪吃蛇玩法
- 方向键或WASD控制
- 吃食物得分
- 撞墙/撞自身结束游戏
- 游戏速度随得分增加而提升

### 2. 双因子认证（MFA）
- 基于RFC 6238标准的TOTP实现
- 支持标准验证器APP绑定
- 自动生成安全密钥
- 支持±1时间窗口验证（30秒前后）
- 兼容主流验证器（Google Authenticator、Microsoft Authenticator、轻网身份验证等）
- 提供账户名称和密钥手动输入
- 独立TOTP注册机工具用于密码重置

### 3. 扫码登录/注册
- 支持自定义扫码链接（IP地址/域名）
- 手机尾号验证登录（4位数字）
- 需要管理员提供的邀请码才能注册
- 登录后自动加载历史游戏记录

### 4. 数据持久化
- 用户信息存储（服务器端JSON文件）
- 游戏记录保存（服务器端JSON文件）
- 登录日志记录（服务器端JSON文件）
- 支持多设备数据同步
- 所有数据使用服务器端存储

### 5. 管理员后台
- 配置管理：
  - 自定义扫码跳转链接
  - 微信群二维码设置
  - 双因子认证（MFA）配置
  - 密码密文显示（增强安全性）
- 邀请码管理：
  - 添加新邀请码
  - 删除邀请码
- 用户管理：
  - 查看所有用户信息
  - 查看用户统计数据
  - 注销用户（禁止登录）
  - 删除用户（永久删除）
- 数据查看：
  - 游戏记录
  - 登录日志（包含IP和设备ID）
- 数据导出：
  - 导出为JSON格式

### 6. 社群引流
- 主页展示微信群二维码
- 管理员可自定义替换

## 使用说明

### 1. 访问游戏
直接在浏览器中打开 `index.html` 文件，或部署到Web服务器。

### 2. 管理员登录
- 默认管理员密码：`admin123`
- 点击主页"进入管理员后台"
- 输入密码进入后台
- 如果已启用双因子认证，需要同时输入密码和动态验证码
- 如果未启用双因子认证，只需输入密码即可登录
- 支持双因子认证（MFA）增强安全性

### 3. 配置系统
首次使用需要配置：
1. **扫码跳转链接**：设置扫码后跳转的访问地址
   - 本地访问：`http://localhost:8888`
   - 局域网：`http://[你的IP]:8888`
   - 域名访问：`http://game.example.com`

2. **微信群二维码**：设置微信群二维码图片URL

3. **邀请码**：添加游戏邀请码，用于用户注册

4. **双因子认证（MFA）**：
   - 启用双因子认证增强管理员账户安全
   - 支持标准TOTP验证器（如Google Authenticator、Microsoft Authenticator等）
   - 支持手动输入密钥绑定
   - 可在后台管理TOTP密钥

5. **管理员密码**：
   - 密码明文显示，方便查看当前密码
   - 留空则不修改密码
   - 修改后立即生效

### 4. 用户注册流程
1. 扫描主页登录二维码
2. 进入注册页面
3. 填写：姓名、手机尾号（4位）、邀请码
4. 提交注册

### 5. 用户登录流程
1. 扫描主页登录二维码
2. 输入手机尾号（4位）
3. 验证通过后进入游戏

### 6. 开始游戏
- 点击"开始游戏"按钮
- 使用方向键或WASD控制蛇移动
- 吃掉红色食物得分
- 撞墙或撞到自己游戏结束

## TOTP注册机

### 功能说明
独立的TOTP验证码生成工具，用于忘记管理员密码时进行密码重置。

### 版本选择
提供三种使用方式：

#### 1. EXE版本（推荐）
- **文件**：`TOTP注册机.exe`
- **特点**：独立可执行文件，无需安装Python
- **界面**：现代化紫色主题，全中文界面
- **功能**：
  - 实时30秒倒计时显示
  - 大字号验证码显示
  - 自动刷新验证码
  - 支持回车键快速生成

#### 2. Python版本
- **文件**：`totp_generator.py`
- **要求**：Python 3.7+
- **使用**：`python totp_generator.py`

#### 3. Web版本
- **文件**：`totp-generator.html`
- **特点**：浏览器中使用，跨平台

### 使用步骤

1. **启动TOTP注册机**
   - 双击运行 `TOTP注册机.exe`

2. **输入TOTP密钥**
   - 输入您的TOTP密钥（Secret Key）
   - 密钥格式：Base32编码（16位字母和数字，如：JBSWY3DPEHPK3PXP）

3. **生成验证码**
   - 点击"生成验证码"按钮或按回车键
   - 验证码每30秒自动更新
   - 倒计时显示剩余时间

4. **重置密码**
   - 访问忘记密码页面（登录页点击"忘记密码"）
   - 输入TOTP密钥和动态验证码
   - 设置新的管理员密码

### 打包说明
- **打包脚本**：`打包TOTP注册机.bat`
- **自动功能**：
  1. 检查Python环境
  2. 检测图标文件（icon.ico 或 ico.png）
  3. 安装/更新PyInstaller
  4. 打包为独立EXE
  5. 清理临时文件
- **输出**：生成 `TOTP注册机.exe`（约9MB）

## 默认配置

### 默认邀请码
- VIP2024
- SNAKE001
- GAME2024

### 管理员密码
- admin123

## 技术栈

- 前端：纯HTML/CSS/JavaScript
- 后端：Node.js + HTTP服务器
- 数据存储：JSON文件（服务器端）
- 二维码：QRCode.js
- TOTP：自定义实现 - 基于RFC 6238标准
- 双因子认证：支持TOTP标准算法
- 跨设备同步：支持局域网多设备数据同步

## 部署说明

### 快速启动
```bash
# 1. 安装依赖
npm install

# 2. 启动服务器
启动服务器.bat
```

服务器默认运行在 `http://localhost:8080`

### 本地部署
1. 启动Node.js服务器：`node server.js` 或双击 `启动服务器.bat`
2. 访问：`http://localhost:8080`

### 局域网部署
1. 配置服务器IP地址
2. 管理员后台设置扫码链接为IP地址
3. 示例：`http://192.168.1.4:8080`

### 外网部署
1. 部署到云服务器
2. 配置域名解析
3. 管理员后台设置扫码链接为域名
4. 示例：`http://game.example.com:8080`

## 注意事项

1. **数据安全**：所有数据存储在服务器端JSON文件，数据在多设备间同步
2. **多设备**：不同设备的数据会自动同步到服务器
3. **访问链接**：扫码链接必须与实际访问地址一致
4. **邀请码**：只有管理员可以生成邀请码，普通用户无法自行生成
5. **TOTP密钥**：启用双因子认证后，请妥善保管TOTP密钥，忘记后将无法通过注册机重置密码
6. **端口占用**：默认端口8080，如被占用可修改server.js中的PORT配置

## 常见问题

### Q: 二维码无法显示？
A: 确保网络正常，QRCode.js库已正确加载。

### Q: 登录后没有历史记录？
A: 确保所有设备都访问服务器地址（不是file://），检查网络连接。

### Q: 导出Excel失败？
A: 确保有相关数据，且浏览器支持文件下载。

### Q: 扫码后跳转错误？
A: 检查管理员后台配置的链接是否与实际访问地址一致。

### Q: 如何启用双因子认证？
A: 在管理员后台点击"启用双因子认证"，使用支持TOTP的验证器APP扫描二维码或手动输入密钥进行绑定。

### Q: 双因子认证验证失败？
A: 确保设备时间准确，TOTP依赖时间同步。如验证失败，可重新扫描二维码绑定。

### Q: 支持哪些验证器APP？
A: 支持所有标准TOTP应用，如Google Authenticator、Microsoft Authenticator、Authy以及国产应用"轻网身份验证"等。

### Q: 如何使用TOTP注册机？
A: 提供了三种版本：
- **EXE版本**（推荐）：运行 `TOTP注册机.exe`，无需安装Python，全中文界面
- **Python版本**：运行 `python totp_generator.py`，需要Python 3.7+
- **网页版本**：打开 `totp-generator.html`，在浏览器中使用

### Q: TOTP验证码不一致？
A: 确保所有设备时间同步，Python注册机、移动APP、Web登录页面现在生成一致的验证码。

### Q: 忘记了TOTP密钥怎么办？
A: TOTP密钥在绑定时应该妥善保存。如果忘记，需要联系技术人员通过其他方式重置系统。

### Q: 如何打包TOTP注册机？
A: 运行 `打包TOTP注册机.bat` 脚本，会自动：
1. 检查环境和图标
2. 安装PyInstaller
3. 打包为EXE
4. 清理临时文件
5. 显示生成结果

## 更新日志

### v2.0.0 (2026-01-08)
**重大更新**
- ✅ 迁移到服务器端存储
  - 使用Node.js API服务器
  - 数据保存在服务器的JSON文件中
  - 支持局域网多设备访问
  - 数据自动同步

**用户身份识别**
- ✅ 记录用户真实IP地址
- ✅ 采集设备唯一ID（浏览器指纹）
- ✅ 准确识别登录设备

**安全性增强**
- ✅ 服务端验证邀请码（防止客户端伪造）
- ✅ 隐藏F12控制台敏感信息
  - 移除管理员密码日志
  - 移除TOTP密钥日志
  - 管理员密码密文显示
- ✅ 防止用户输入错误数据
- ✅ 登录日志自动记录

**UI/UX优化**
- ✅ 独立的用户管理页面
- ✅ 用户统计卡片
- ✅ 用户注销和删除功能
- ✅ IP地址IPv4格式显示
- ✅ TOTP注册机界面全面升级
  - 现代化紫色主题设计
  - 全中文界面
  - 实时30秒倒计时
  - 自动刷新验证码
  - 大字号验证码显示

**UI/UX优化**
- ✅ TOTP注册机界面全面升级
  - 现代化紫色主题设计
  - 全中文界面
  - 实时30秒倒计时（30→29→28...）
  - 自动刷新验证码
  - 大字号验证码显示
  - 支持回车键快速生成
- ✅ 管理员密码明文显示
  - 配置页面密码输入框显示当前值
  - 方便查看和确认密码

**打包优化**
- ✅ 提供完整的打包脚本
- ✅ 自动图标检测和转换
- ✅ 自定义图标集成
- ✅ 文件整理和清理

### v1.1.0 (2025-01-08)
- 优化登录页面逻辑：根据双因子开关动态显示验证码输入框
- 新增忘记密码功能：支持通过TOTP密钥重置系统密码
- 创建独立TOTP注册机工具：
  - Python版本：使用tkinter创建桌面GUI应用
  - 支持打包为独立EXE文件（无需安装Python）
  - 支持输入TOTP密钥生成动态验证码
  - 提供30秒倒计时显示和进度条
  - 可用于忘记密码时恢复系统
  - 提供完整的打包脚本和使用文档
- 新增"忘记密码"链接到管理员登录页面
- 更新使用说明文档

### v1.0.0 (2025-01-06)
- 初始版本发布
- 实现核心游戏功能
- 实现扫码登录/注册
- 实现管理员后台
- 实现数据持久化和导出
- 新增双因子认证（MFA）功能：
  - 支持标准TOTP验证器
  - 基于RFC 6238实现
  - 支持手动输入密钥绑定
  - 兼容主流验证器APP（Google Authenticator、Microsoft Authenticator、轻网身份验证等）
- 优化管理员登录安全性
- 完善文档说明

---

**项目地址**：d:\ftp\贪吃蛇
**最后更新**：2026-01-08
**当前版本**：v2.0.0
