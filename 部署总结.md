# è´ªåƒè›‡æ¸¸æˆ - éƒ¨ç½²å®Œæˆæ€»ç»“

## ğŸ“‹ éƒ¨ç½²ä¿¡æ¯

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨ IP**: 8.138.27.63
- **åŸŸå**: tcs.ctf-wb.cn
- **Node.js ç«¯å£**: 8888ï¼ˆå†…éƒ¨ï¼‰
- **Nginx ç«¯å£**: 80 (HTTP), 443 (HTTPS)
- **SSL è¯ä¹¦**: Let's Encryptï¼ˆæœ‰æ•ˆæœŸè‡³ 2026-04-08ï¼‰

### è®¿é—®åœ°å€
- **HTTPS è®¿é—®**: `https://8.138.27.63` æˆ– `https://tcs.ctf-wb.cn`
- **HTTP è®¿é—®**: `http://8.138.27.63` æˆ– `http://tcs.ctf-wb.cn`ï¼ˆè‡ªåŠ¨è·³è½¬ HTTPSï¼‰
- **ç®¡ç†åå°**: `https://8.138.27.63/admin` æˆ– `https://tcs.ctf-wb.cn/admin`
- **é»˜è®¤ç®¡ç†å‘˜å¯†ç **: `admin123`
- **ç®¡ç†å‘˜ä¼šè¯è¶…æ—¶**: 5åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨é€€å‡º

---

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. ç³»ç»Ÿç¯å¢ƒ
- âœ… Node.js 18.x å·²å®‰è£…
- âœ… Nginx å·²å®‰è£…
- âœ… Certbot å·²å®‰è£…ï¼ˆç”¨äº SSL è¯ä¹¦ç®¡ç†ï¼‰

### 2. åº”ç”¨éƒ¨ç½²
- âœ… é¡¹ç›®æ–‡ä»¶å·²éƒ¨ç½²åˆ° `/opt/snake-game/`
- âœ… æ–‡ä»¶æƒé™å·²æ­£ç¡®è®¾ç½®ï¼ˆdata ç›®å½• 777ï¼‰
- âœ… systemd æœåŠ¡å·²é…ç½®å¹¶è¿è¡Œ
- âœ… Node.js æœåŠ¡å·²åœ¨ 8888 ç«¯å£è¿è¡Œ

### 3. Nginx é…ç½®
- âœ… åå‘ä»£ç†å·²é…ç½®ï¼ˆ80/443 â†’ 8888ï¼‰
- âœ… HTTP è‡ªåŠ¨è·³è½¬ HTTPS å·²é…ç½®
- âœ… SSL è¯ä¹¦å·²é…ç½®ï¼ˆLet's Encryptï¼‰
- âœ… HTTP/2 å·²å¯ç”¨
- âœ… é™æ€èµ„æºç¼“å­˜å·²é…ç½®ï¼ˆ7 å¤©ï¼‰

### 4. SSL è¯ä¹¦
- âœ… Let's Encrypt è¯ä¹¦å·²ç”³è¯·æˆåŠŸ
- âœ… è¯ä¹¦æœ‰æ•ˆæœŸï¼š90 å¤©ï¼ˆåˆ° 2026-04-08ï¼‰
- âœ… è‡ªåŠ¨ç»­æœŸå·²é…ç½®ï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹æ£€æŸ¥ï¼‰

### 5. å®‰å…¨é…ç½®
- âœ… é˜²ç«å¢™å·²å¼€æ”¾ 80 å’Œ 443 ç«¯å£
- âœ… äº‘æœåŠ¡å™¨å®‰å…¨ç»„å·²é…ç½®
- âœ… SSL å®‰å…¨å¤´éƒ¨å·²é…ç½®

### 6. åŠŸèƒ½ä¼˜åŒ–
- âœ… äºŒç»´ç è‡ªåŠ¨è¯†åˆ«å½“å‰è®¿é—®åœ°å€ï¼ˆæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼‰
- âœ… æ”¯æŒåŸŸåå’Œ IP è®¿é—®
- âœ… å…¨ç«™ HTTPS è®¿é—®

---

## ğŸ”§ æœåŠ¡ç®¡ç†å‘½ä»¤

### Node.js æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
systemctl start snake-game

# åœæ­¢æœåŠ¡
systemctl stop snake-game

# é‡å¯æœåŠ¡
systemctl restart snake-game

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status snake-game

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u snake-game -f
```

### Nginx æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨ Nginx
systemctl start nginx

# åœæ­¢ Nginx
systemctl stop nginx

# é‡å¯ Nginx
systemctl restart nginx

# é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
nginx -s reload

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status nginx

# æµ‹è¯•é…ç½®æ–‡ä»¶
nginx -t
```

### è¯ä¹¦ç®¡ç†

```bash
# æ‰‹åŠ¨ç»­æœŸè¯ä¹¦
certbot renew

# æµ‹è¯•ç»­æœŸ
certbot renew --dry-run

# æŸ¥çœ‹ SSL è¯ä¹¦ä¿¡æ¯
ls -la /etc/letsencrypt/live/tcs.ctf-wb.cn/

# æŸ¥çœ‹ crontab å®šæ—¶ä»»åŠ¡
crontab -l
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# Node.js æ—¥å¿—
journalctl -u snake-game -f

# Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/snake-game-access.log

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/snake-game-error.log

# æŸ¥çœ‹æœ€è¿‘ 50 è¡Œ
journalctl -u snake-game -n 50
```

---

## ğŸ“ é‡è¦æ–‡ä»¶è·¯å¾„

### åº”ç”¨æ–‡ä»¶
```
/opt/snake-game/
â”œâ”€â”€ server.js              # Node.js æœåŠ¡å™¨ä¸»æ–‡ä»¶
â”œâ”€â”€ index.html             # é¦–é¡µ
â”œâ”€â”€ js/                   # JavaScript æ–‡ä»¶
â”‚   â”œâ”€â”€ router.js         # è·¯ç”±å’Œé¡µé¢æ¸²æŸ“ï¼ˆå·²ä¼˜åŒ–è‡ªåŠ¨è¯†åˆ«è®¿é—®åœ°å€ï¼‰
â”‚   â”œâ”€â”€ dataManager.js    # æ•°æ®ç®¡ç†
â”‚   â””â”€â”€ ...
â”œâ”€â”€ css/                  # æ ·å¼æ–‡ä»¶
â””â”€â”€ data/                 # æ•°æ®ç›®å½•
    â”œâ”€â”€ users.json         # ç”¨æˆ·æ•°æ®
    â”œâ”€â”€ games.json        # æ¸¸æˆè®°å½•
    â”œâ”€â”€ login-logs.json   # ç™»å½•æ—¥å¿—
    â””â”€â”€ admin-config.json # ç®¡ç†å‘˜é…ç½®
```

### é…ç½®æ–‡ä»¶
```
/etc/systemd/system/snake-game.service          # systemd æœåŠ¡é…ç½®
/etc/nginx/conf.d/snake-game.conf              # Nginx é…ç½®
/etc/letsencrypt/live/tcs.ctf-wb.cn/        # Let's Encrypt è¯ä¹¦
```

### æ—¥å¿—æ–‡ä»¶
```
/var/log/journal/               # systemd æ—¥å¿—ï¼ˆsnake-gameï¼‰
/var/log/nginx/snake-game-access.log    # Nginx è®¿é—®æ—¥å¿—
/var/log/nginx/snake-game-error.log     # Nginx é”™è¯¯æ—¥å¿—
```

---

## ğŸ”„ æ—¥å¸¸ç»´æŠ¤

### æ¯æ—¥æ£€æŸ¥
- [ ] æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### æ¯å‘¨æ£€æŸ¥
- [ ] æ£€æŸ¥è¯ä¹¦ç»­æœŸçŠ¶æ€
- [ ] å¤‡ä»½æ•°æ®æ–‡ä»¶
- [ ] æ£€æŸ¥ç³»ç»Ÿæ›´æ–°

### æ¯æœˆæ£€æŸ¥
- [ ] ç³»ç»Ÿå®‰å…¨æ›´æ–°
- [ ] æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- [ ] æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

### æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
systemctl status snake-game nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E "80|443|8888"
```

### èµ„æºä½¿ç”¨
```bash
# æŸ¥çœ‹å†…å­˜å’Œ CPU ä½¿ç”¨
htop

# æˆ–ä½¿ç”¨ top
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ç›®å½•å¤§å°
du -sh /opt/snake-game
du -sh /opt/snake-game/data
```

### ç½‘ç»œè¿æ¥
```bash
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
netstat -an | grep ESTABLISHED | wc -l

# æŸ¥çœ‹ç«¯å£è¿æ¥
netstat -an | grep :80
netstat -an | grep :443
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. å®šæœŸå¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½è„šæœ¬
cat > /root/backup-snake.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/opt/backups"
DATA_DIR="/opt/snake-game/data"

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/snake-game-$DATE.tar.gz $DATA_DIR

# ä¿ç•™æœ€è¿‘ 7 å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "snake-game-*.tar.gz" -mtime +7 -delete

echo "Backup completed: snake-game-$DATE.tar.gz"
EOF

chmod +x /root/backup-snake.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 1 ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ : 0 1 * * * /root/backup-snake.sh >> /var/log/backup.log 2>&1
```

### 2. ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 

è®¿é—®ç®¡ç†åå° `https://8.138.27.63/admin` æˆ– `https://tcs.ctf-wb.cn/admin`ï¼Œä¿®æ”¹é»˜è®¤å¯†ç ã€‚

### 3. å¯ç”¨ MFA åŒå› ç´ è®¤è¯

åœ¨ç®¡ç†åå°å¯ç”¨ MFA åŠŸèƒ½ï¼Œä½¿ç”¨ TOTP åº”ç”¨è¿›è¡ŒäºŒæ¬¡éªŒè¯ã€‚

### 4. é™åˆ¶ç®¡ç†å‘˜è®¿é—®

å¯ä»¥åœ¨ Nginx é…ç½®ä¸­æ·»åŠ  IP ç™½åå•ï¼š

```nginx
# åªå…è®¸ç‰¹å®š IP è®¿é—®ç®¡ç†åå°
location /admin {
    allow ä½ çš„ç®¡ç†å‘˜IP;
    deny all;

    proxy_pass http://127.0.0.1:8888;
    ...
}
```

---

## ğŸš¨ æ•…éšœå¤„ç†

### ç½‘ç«™æ— æ³•è®¿é—®

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status snake-game
systemctl status nginx

# 2. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep -E "80|443|8888"

# 3. æ£€æŸ¥æ—¥å¿—
journalctl -u snake-game -n 50
tail -f /var/log/nginx/snake-game-error.log

# 4. é‡å¯æœåŠ¡
systemctl restart snake-game
systemctl restart nginx
```

### SSL è¯ä¹¦é—®é¢˜

```bash
# 1. æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ
ls -la /etc/letsencrypt/live/tcs.ctf-wb.cn/

# 2. æ‰‹åŠ¨ç»­æœŸ
certbot renew --force-renewal

# 3. é‡æ–°åŠ è½½ Nginx
nginx -s reload
```

### æ€§èƒ½é—®é¢˜

```bash
# 1. æŸ¥çœ‹èµ„æºä½¿ç”¨
htop

# 2. æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# 3. æŸ¥çœ‹è¿æ¥æ•°
netstat -an | grep ESTABLISHED | wc -l

# 4. æ¸…ç†æ—§æ—¥å¿—
find /var/log -name "*.log" -mtime +30 -delete
journalctl --vacuum-time=30d
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜

**Q: å¦‚ä½•ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Ÿ**
A: è®¿é—®ç®¡ç†åå°ï¼Œåœ¨è®¾ç½®ä¸­ä¿®æ”¹å¯†ç ã€‚

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**
A: æ‰§è¡Œ `/root/backup-snake.sh` è„šæœ¬æˆ–æ‰‹åŠ¨å¤‡ä»½ `/opt/snake-game/data` ç›®å½•ã€‚

**Q: å¦‚ä½•æ›´æ–°åº”ç”¨ï¼Ÿ**
A: ä¸Šä¼ æ–°æ–‡ä»¶åˆ° `/opt/snake-game/`ï¼Œé‡å¯æœåŠ¡ `systemctl restart snake-game`ã€‚

**Q: è¯ä¹¦å³å°†è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ**
A: Let's Encrypt ä¼šè‡ªåŠ¨ç»­æœŸï¼Œå¦‚éœ€æ‰‹åŠ¨ç»­æœŸï¼š`certbot renew`ã€‚

**Q: äºŒç»´ç æ˜¾ç¤ºé”™è¯¯åœ°å€æ€ä¹ˆåŠï¼Ÿ**
A: å·²ä¼˜åŒ–è‡ªåŠ¨è¯†åˆ«å½“å‰è®¿é—®åœ°å€ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ã€‚

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### åˆæ¬¡éƒ¨ç½²å
- [ ] æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆsnake-game, nginxï¼‰
- [ ] å¯ä»¥é€šè¿‡ IP è®¿é—®ç½‘ç«™
- [ ] å¯ä»¥é€šè¿‡åŸŸåè®¿é—®ç½‘ç«™
- [ ] HTTPS æ­£å¸¸å·¥ä½œï¼ˆæ˜¾ç¤ºå®‰å…¨é”ï¼‰
- [ ] æ¸¸æˆåŠŸèƒ½æ­£å¸¸ï¼ˆæ³¨å†Œã€ç™»å½•ã€æ¸¸æˆï¼‰
- [ ] äºŒç»´ç æ˜¾ç¤ºæ­£ç¡®çš„è®¿é—®åœ°å€
- [ ] ç®¡ç†åå°å¯ä»¥è®¿é—®
- [ ] æ—¥å¿—æ— é”™è¯¯

### æ—¥å¸¸ç»´æŠ¤
- [ ] æ•°æ®å¤‡ä»½æ­£å¸¸æ‰§è¡Œ
- [ ] SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸæ­£å¸¸
- [ ] ç£ç›˜ç©ºé—´å……è¶³ï¼ˆè‡³å°‘ 20% å¯ç”¨ï¼‰
- [ ] æœåŠ¡èµ„æºä½¿ç”¨æ­£å¸¸
- [ ] é˜²ç«å¢™è§„åˆ™æ­£ç¡®
- [ ] äº‘æœåŠ¡å™¨å®‰å…¨ç»„é…ç½®æ­£ç¡®

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
systemctl status snake-game nginx

# é‡å¯æ‰€æœ‰æœåŠ¡
systemctl restart snake-game nginx

# æŸ¥çœ‹æ‰€æœ‰ç«¯å£ç›‘å¬
netstat -tlnp | grep -E "80|443|8888"

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u snake-game -f
tail -f /var/log/nginx/snake-game-error.log

# å¤‡ä»½æ•°æ®
tar -czf backup-$(date +%Y%m%d).tar.gz /opt/snake-game/data

# ç»­æœŸ SSL è¯ä¹¦
certbot renew --post-hook "nginx -s reload"

# æµ‹è¯•æœåŠ¡
curl http://localhost:8888
curl -k https://localhost -I
curl -I https://tcs.ctf-wb.cn
```

---

**éƒ¨ç½²å®Œæˆæ—¥æœŸ**: 2026-01-08
**éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ
**SSL è¯ä¹¦æœ‰æ•ˆæœŸ**: 2026-04-08
**è‡ªåŠ¨ç»­æœŸ**: âœ… å·²é…ç½®
