# 贪吃蛇游戏 - 服务器版使用说明

## 🎉 新功能

### 服务器端数据存储
- ✅ 使用 Node.js API 服务器
- ✅ 数据保存在服务器的 JSON 文件中
- ✅ 手机和电脑数据自动同步
- ✅ 支持局域网多设备访问

### 用户身份识别
- ✅ 记录用户真实 IP 地址
- ✅ 采集设备唯一 ID（浏览器指纹）
- ✅ 准确识别登录设备

### 安全性增强
- ✅ 服务端验证邀请码（防止客户端伪造）
- ✅ 防止用户输入错误数据
- ✅ 登录日志自动记录

## 📋 安装和启动

### 1. 安装 Node.js
访问 https://nodejs.org/ 下载并安装 Node.js（LTS版本）

### 2. 启动服务器

#### Windows 系统：
双击运行 `启动服务器.bat`

#### Linux/Mac 系统：
```bash
cd 贪吃蛇
npm start
```

### 3. 访问游戏

**注意：默认端口是 8080**

#### 电脑访问：
打开浏览器访问：http://localhost:8080

#### 局域网其他设备访问：
1. 查看服务器启动时显示的 IP 地址
2. 手机/电脑访问：http://[IP地址]:8080
   例如：http://192.168.1.4:8080

#### 如果需要修改端口：
编辑 `server.js` 文件最后一行，修改端口数字：
```javascript
const PORT = process.env.PORT || 8080;  // 修改这里的数字
```

## 🔧 配置说明

### 首次配置
1. 访问游戏主页
2. 点击"进入管理员后台"
3. 输入默认密码：`admin123`
4. 修改"扫码链接"为实际访问地址
   - 本地：http://localhost:8080
   - 局域网：http://192.168.1.4:8080
   或直接输入 IP 地址：http://[你的IP]:8080
5. 添加或修改邀请码
6. 点击"用户管理"可以查看和删除用户

## 📊 数据存储位置

所有数据保存在 `data/` 目录：
- `users.json` - 用户数据
- `games.json` - 游戏记录
- `login-logs.json` - 登录日志
- `admin-config.json` - 管理员配置

## 🎯 功能说明

### 1. 用户注册
- 输入姓名
- 输入手机尾号（4位）
- 输入邀请码（由管理员提供）
- 系统自动记录：
  - 注册时间
  - 注册 IP 地址
  - 设备唯一 ID

### 2. 用户登录
- 输入手机尾号
- 系统自动记录：
  - 登录时间
  - 登录 IP 地址
  - 设备唯一 ID

### 3. 管理员后台
- 查看所有用户（包含设备 ID 和 IP）
- 查看游戏记录
- 查看登录日志（包含 IP 和设备 ID）
- 导出数据为 JSON 格式
- 删除用户

## 🔐 安全性

### IP 地址记录
- X-Forwarded-For（代理头部）
- X-Real-IP（代理头部）
- 直接连接 IP

### 设备 ID 生成
- User Agent
- 浏览器语言
- 屏幕分辨率
- Canvas 指纹
- 随机因子

## ⚠️ 注意事项

1. **端口冲突**
   - 如果 8080 端口被占用，修改 `package.json` 中的端口
   - 或设置环境变量：`set PORT=3000`

2. **防火墙**
   - Windows：允许 Node.js 通过防火墙
   - Linux：`sudo firewall-cmd --add-port=8080/tcp --permanent && sudo firewall-cmd --reload`

3. **局域网访问**
   - 确保手机和电脑在同一局域网
   - 服务器 IP 可通过命令查看：
     - Windows：`ipconfig`
     - Linux/Mac：`ifconfig`

4. **数据备份**
   - 定期备份 `data/` 目录
   - 可以直接复制整个文件夹

## 🐛 故障排除

### Q: 无法访问游戏？
A:
1. 检查服务器是否启动
2. 检查防火墙设置
3. 检查 IP 地址是否正确

### Q: 数据没有同步？
A:
1. 确保都访问服务器地址（不是 file://）
2. 检查网络连接
3. 打开浏览器控制台查看错误

### Q: 邀请码无效？
A:
1. 在管理员后台检查邀请码列表
2. 确认邀请码是否正确输入
3. 邀请码区分大小写

### Q: 设备 ID 不同？
A:
正常现象！不同浏览器会有不同的设备 ID，因为：
- Canvas 指纹不同
- User Agent 不同
- 屏幕分辨率可能不同

## 📱 移动端优化

- 支持触摸控制
- 虚拟方向按钮
- 响应式布局

## 🔄 更新日志

### v2.0.0 (服务器版)
- ✅ 添加 Node.js API 服务器
- ✅ 使用服务器端 JSON 文件存储
- ✅ 支持多设备数据同步
- ✅ 记录用户真实 IP 地址
- ✅ 采集设备唯一 ID
- ✅ 服务端验证邀请码
- ✅ 优化数据加载性能（缓存）

### v1.0.0
- 初始版本
- LocalStorage 存储
